<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>千千音乐-听见世界</title>
    <link rel="icon" type="image/x-icon"
          href="https://sls-study-cloud-1301165591.cos.ap-guangzhou.myqcloud.com/music/img/favicon.ico"/>
    <link rel="stylesheet" th:href="@{/css/b34ba44cfddedd3fcb45.css}"/>
    <link rel="stylesheet" th:href="@{/css/f0c121bf9729755d1933.css}"/>
    <link rel="stylesheet" th:href="@{/css/4128696a8dd92d32da65.css}"/>
    <link rel="stylesheet" th:href="@{/css/index.css}"/>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"/>
    <script type="text/javascript" th:src="@{/js/jquery-1.10.2.js}"></script>
    <script th:src="@{/layui/layui.js}"></script>
    <style>

        .layui-form-select dl dd.layui-this {
            background-color: #c2c2c2;
            color: #fff;
        }

    </style>
</head>

<body>
<div data-server-rendered="true" id="__nuxt">
    <!---->
    <div id="__layout">
        <div>
            <!--头部-->
            <footer th:replace="fontdesk/head::footer-fragment-head"></footer>

            <div style="margin:20px 50px;">
                <h2>个人资料</h2>

                <div data-v-2bbe050e="" data-v-72420e77="" class="container page-container page-main">
                    <br />
                    <form data-v-2bbe050e="" class="el-form el-form--label-top layui-form">
                        <div data-v-2bbe050e="" class="el-form-item"><label class="el-form-item__label">头像</label>
                            <div class="el-form-item__content">
                                <div data-v-384ce798="" data-v-2bbe050e="" class="user-avatar-box clearfix">
                                    <div data-v-384ce798="" class="el-image avatar fl"><img
                                            onclick="fils()"
                                            id="tp"
                                            th:src="${session.user.usimg}"
                                            class="el-image__inner" style="width:180px;height: 180px;border-radius:50%;object-fit: cover;"><!----></div>
                                    <input type="file"  id="finp" name="files" style="display:none;" onchange="wj(this)"/>

                                    <br />
                                    <div style="margin-left: 30px;" data-v-384ce798="" class="avatar-info">
                                        <div data-v-384ce798="" class="avatar-uploader">
                                            <div tabindex="0" class="el-upload el-upload--text">
                                                <button style="margin-left: 30px;" data-v-384ce798="" type="button"
                                                        onclick="txsc()"
                                                        class="el-button el-button--default is-round"><!---->
                                                    <!----><span>上传头像</span></button>
                                            </div>
                                        </div>
                                    </div>
                                <!---->
                                </div>
                            </div>
                        </div>
                        <br />
                        <div data-v-2bbe050e="" class="el-row" style="margin-left: -15px; margin-right: -15px;">
                            <div data-v-2bbe050e="" class="el-col el-col-8"
                                 style="padding-left: 15px; padding-right: 15px;">
                                <div data-v-2bbe050e="" class="el-form-item is-success is-required"><label
                                        for="nickname" class="el-form-item__label"><span data-v-2bbe050e="">
                        昵称
                        <span data-v-2bbe050e="" class="tips">最多10个字符</span></span></label>
                                    <div>
                                        <div class="layui-input-inline">
                                            <input type="text" name="number" autocomplete="off" class="layui-input"
                                                   placeholder="昵称" maxlength="10" id="mc" th:value="${session.user.usname}" >
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div data-v-2bbe050e="" class="el-col el-col-8"
                                 style="padding-left: 15px; padding-right: 15px;">
                                <div data-v-2bbe050e="" class="el-form-item"><label for="sex" class="el-form-item__label">性别</label>

                                    <div>
                                        <div class="layui-input-inline">
                                            <select name="quiz1" id="xb">
                                                <option value="0" th:if="${session.user.sex==0}" selected="">保密</option>
                                                <option value="1" th:if="${session.user.sex==0}" >男</option>
                                                <option value="2" th:if="${session.user.sex==0}" >女</option>
                                                <option value="0" th:if="${session.user.sex==1}" >保密</option>
                                                <option value="1" th:if="${session.user.sex==1}" selected="">男</option>
                                                <option value="2" th:if="${session.user.sex==1}" >女</option>
                                                <option value="0" th:if="${session.user.sex==2}" >保密</option>
                                                <option value="1" th:if="${session.user.sex==2}" >男</option>
                                                <option value="2" th:if="${session.user.sex==2}" selected="">女</option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div data-v-2bbe050e="" class="el-col el-col-8"
                                 style="padding-left: 15px; padding-right: 15px;">
                                <div data-v-2bbe050e="" class="el-form-item"><label for="age"
                                                                                    class="el-form-item__label">年龄</label>
                                    <div>
                                        <div class="layui-input-inline">
                                           <!-- 文本框只能输入数字代码(小数点也不能输入) -->
                                            <input type="text" name="number" autocomplete="off" class="layui-input"
                                                   placeholder="年龄" maxlength="3" id="nl" th:value="${session.user.age}"
                                                   onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div data-v-2bbe050e="" class="el-form-item"><label for="intro"
                                                                            class="el-form-item__label">简介</label>
                            <div class="el-form-item__content">
                                <div data-v-2bbe050e="" class="el-textarea">
                                    <textarea rows="3" class="el-textarea__inner" style="min-height: 33px;"
                                              id="jj" th:text="${session.user.usintro}" ></textarea>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div data-v-2bbe050e="" class="el-form-item"><!---->
                            <div class="el-form-item__content">
                                <button data-v-2bbe050e="" type="button" onclick="bc()"
                                        class="el-button el-button--primary is-round">
                                    <!----><!----><span>保存</span></button><!----></div>
                        </div>
                    </form>
                </div>
            </div>

            <!--尾部-->
            <footer th:replace="fontdesk/foot::footer-fragment"></footer>
        </div>
    </div>
</div>
</body>
<script>
    //热门歌单详情
    function gdxx(gid) {
        location.href = "/songdeta/" + gid;
    }

    //搜索输入框回车事件
    $("#seav").keyup(function () {
        if (event.keyCode == 13) {
            srea();
        }
    });

    //搜索
    function srea() {
        const serval = $("#seav").val();
        if (serval == "") {

        } else {
            location.href = "/search/" + serval;
        }
    }


    function fils(){
        $("#finp").click();
    }

    // 图片预览
    //预先定义一个FormData对象
    var formData = new FormData();
    let file = null;
    function wj(ev){
        var sr=document.getElementById("tp");
        //获取文件对象
        file = ev.files[0];
        formData.append('multipart',file);
        //获取文件阅读器
        let reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function(){
            //给img的src设置图片url
            sr.setAttribute("src", this.result);
        }
    }

    // 头像上传
    function txsc() {
        if(file==null){
            layer.msg("请选择上传图片！",{offset:['100px']});
            return;
        }
        $.ajax({
            url: '/user/uptx',
            type: 'post',
            cache: false,
            data:formData,
            //这个参数是jquery特有的，不进行序列化，因为我们不是json格式的字符串，而是要传文件
            processData: false,
            //注意这里一定要设置contentType:false，不然会默认为传的是字符串，这样文件就传不过去了
            contentType: false,
            dataType:'json',
            success:function(data) {
                // console.log(data);
                if(data.code==200){
                    // console.log(data.data.img[0]);
                    layer.msg("上传成功！",{offset:['100px']});
                    location.href=location.href;
                }else if(data.code==500){
                    layer.msg("上传失败！",{offset:['100px']});
                }
            }
        });
        formData = new FormData();
        file = null;
    }

    // 保存信息
    function bc() {
        var name = $("#mc").val();
        var sex = $("#xb").val();
        var age = $("#nl").val();
        var info= document.getElementById("jj").value;
        if(name==''){
            layer.msg('名称不能为空！',{offset:['100px']});
            return;
        }

        // console.log(name);
        // console.log(sex);
        // console.log(age);
        // console.log(info);

        $.ajax({
            url: '/user/upinfo',
            type:"post",
            // contentType:'application/json',  //发送数据类型
            data:{
                "usname":name,
                "sex":sex,
                "age":age,
                "usintro":info
            },
            dataType : "json",  //接受数据格式
            complete : function(xhr, status) {
                //拦截器拦截没有权限跳转
                // 通过xhr取得响应头
                var REDIRECT = xhr.getResponseHeader("REDIRECT");
                //如果响应头中包含 REDIRECT 则说明是拦截器返回的
                if (REDIRECT == "REDIRECT") {
                    document.location.href = xhr.getResponseHeader("CONTEXTPATH");
                }
            },
            success:function(da){
                // console.log(da);
                if(da.code==200){
                    layer.msg(da.msg,{offset:['100px']});

                }else if(da.code=500){
                    layer.msg(da.msg,{offset:['100px']});
                }
            }
        });
    }

</script>
</html>